{
  "hash": "4d672a9b613035495c1744136a6770c5",
  "result": {
    "engine": "knitr",
    "markdown": "# Análisis de Correlación\n\nLa **análisis de correlación** se utiliza para evaluar la fuerza y la dirección de la relación entre dos variables continuas. Mide el grado de asociación lineal entre las variables. La medida más común de correlación es el **coeficiente de correlación de Pearson**.\n\n## Preparo pre-análisis y visualización\n\nPrimero, cargamos los paquetes necesarios y los datos. Utilizaremos los paquetes `tidyverse`, `readxl` y `ggplot2` para la manipulación y visualización de datos.\n\n### Cargar Paquetes\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cargar paquetes necesarios\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(ggplot2)\nlibrary(ggthemes)\nlibrary(corrplot)\n```\n:::\n\n\n### Importar Datos\n\nImportamos los datos desde un archivo Excel. En este ejemplo, trabajamos con un conjunto de datos llamado `estande`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Importar datos desde un archivo Excel\nestande <- read_excel(\"dados-diversos.xlsx\", \"estande\")\n\n\nestande |> \n    DT::datatable(\n    extensions = 'Buttons', \n    options = list(dom = 'Bfrtip', \n    buttons = c('excel', \"csv\")))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-3caab5103b91fcb9dcff\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-3caab5103b91fcb9dcff\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"extensions\":[\"Buttons\"],\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\",\"37\",\"38\",\"39\",\"40\",\"41\",\"42\",\"43\",\"44\",\"45\",\"46\",\"47\",\"48\",\"49\",\"50\",\"51\",\"52\",\"53\",\"54\",\"55\",\"56\",\"57\",\"58\",\"59\",\"60\",\"61\",\"62\",\"63\",\"64\",\"65\",\"66\",\"67\",\"68\",\"69\",\"70\",\"71\",\"72\"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,3,3,3,3,6,6,6,6,12,12,12,12,24,24,24,24,48,48,48,48,0,0,0,0,3,3,3,3,6,6,6,6,12,12,12,12,24,24,24,24,48,48,48,48,0,0,0,0,3,3,3,3,6,6,6,6,12,12,12,12,24,24,24,24,48,48,48,48],[1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4],[66,72,50,27,68,79,31,32,58,56,64,33,56,53,50,29,63,44,24,44,48,44,40,39,80,61,75,79,60,47,53,67,31,34,76,59,50,34,61,52,33,38,37,50,34,18,34,40,101,94,93,105,93,97,96,109,99,95,74,89,99,79,84,60,67,68,81,84,49,79,61,58]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>exp<\\/th>\\n      <th>trat<\\/th>\\n      <th>bloco<\\/th>\\n      <th>nplants<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"dom\":\"Bfrtip\",\"buttons\":[\"excel\",\"csv\"],\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"exp\",\"targets\":1},{\"name\":\"trat\",\"targets\":2},{\"name\":\"bloco\",\"targets\":3},{\"name\":\"nplants\",\"targets\":4}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n### Visualización de Datos\n\nVisualizamos los datos para obtener una idea preliminar de la relación entre las variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nestande |>\n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  facet_wrap(~ exp)+\n  ylim(0, max(estande$nplants))+\n  geom_smooth(se = FALSE)+\n  theme_few()\n```\n\n::: {.cell-output-display}\n![](Aula14_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nestande |>\n  ggplot(aes(trat, nplants))+\n  geom_point(colour=\"gray\")+\n  facet_wrap(~ exp)+\n  stat_summary(fun.data = \"mean_cl_boot\",color=\"#8b0000\")+ \n  geom_smooth(se =  F, method = \"lm\",colour= \"#9cc414\")+\n  theme_clean()\n```\n\n::: {.cell-output-display}\n![](Aula14_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n## Ajustando Modelo Lineal Simple y Cuadrático\n\n### Ajuste del Modelo Lineal Simple\n\nUtilizamos la función `lm()` para ajustar un modelo lineal simple. La fórmula del modelo especifica la relación entre la variable dependiente (`y`) y la variable independiente (`x`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filtrar los datos del experimento 2\nestande2 <- estande |>\n  filter(exp == 2) |>\n  group_by(trat) |>\n  summarise(mean_nplants = mean(nplants))\n\n# Ajustar el modelo lineal simple\nmodelo_simple <- lm(mean_nplants ~ trat, data = estande2)\nsummary(modelo_simple)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = mean_nplants ~ trat, data = estande2)\n\nResiduals:\n     1      2      3      4      5      6 \n12.764 -2.134 -6.782 -3.327 -4.669  4.147 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  60.9857     4.5505  13.402 0.000179 ***\ntrat         -0.7007     0.2012  -3.483 0.025294 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 8.117 on 4 degrees of freedom\nMultiple R-squared:  0.752,\tAdjusted R-squared:   0.69 \nF-statistic: 12.13 on 1 and 4 DF,  p-value: 0.02529\n```\n\n\n:::\n:::\n\n\n### Ajuste del Modelo Cuadrático\n\nPara ajustar un modelo cuadrático, incluimos la variable independiente al cuadrado en la fórmula del modelo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Crear la variable cuadrática\nestande2 <- estande2 |>\n  mutate(trat2 = trat^2)\n\n# Ajustar el modelo cuadrático\nmodelo_cuadratico <- lm(mean_nplants ~ trat + trat2, data = estande2)\nsummary(modelo_cuadratico)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = mean_nplants ~ trat + trat2, data = estande2)\n\nResiduals:\n      1       2       3       4       5       6 \n 7.4484 -4.4200 -6.4386  1.0739  3.0474 -0.7111 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 66.30156    4.70800  14.083 0.000776 ***\ntrat        -1.77720    0.62263  -2.854 0.064878 .  \ntrat2        0.02223    0.01242   1.790 0.171344    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 6.517 on 3 degrees of freedom\nMultiple R-squared:  0.8801,\tAdjusted R-squared:  0.8001 \nF-statistic: 11.01 on 2 and 3 DF,  p-value: 0.04152\n```\n\n\n:::\n:::\n\n\n### Comparación de Modelos\n\nUtilizamos el criterio de información de Akaike (AIC) para comparar los modelos ajustados.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAIC(modelo_simple, modelo_cuadratico)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  df      AIC\nmodelo_simple      3 45.72200\nmodelo_cuadratico  4 43.36151\n```\n\n\n:::\n:::\n\n\n### Visualización del Modelo Ajustado\n\nVisualizamos el modelo ajustado y añadimos la ecuación de la regresión en el gráfico.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extraer coeficientes del modelo cuadrático\nintercepto <- coef(modelo_cuadratico)[1]\npendiente1 <- coef(modelo_cuadratico)[2]\npendiente2 <- coef(modelo_cuadratico)[3]\n\n# Crear la ecuación en formato de texto\necuacion <- paste(\"y =\", round(intercepto, 2), \"+\", round(pendiente1, 2), \"* x +\", round(pendiente2, 2), \"* x^2\")\n\n# Crear el gráfico con la ecuación del modelo cuadrático\nggplot(estande2, aes(x = trat, y = mean_nplants)) +\n  geom_point() +\n  geom_smooth(formula = y ~ poly(x, 2), method = \"lm\", color = \"black\") +\n  annotate(\"text\", x = 25, y = 70, label = ecuacion, color = \"blue\", size = 5) +\n  labs(title = \"Relación entre Tratamiento y Número de Plantas\", x = \"Tratamiento\", y = \"Número de Plantas\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Aula14_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n# Análisis de Correlación entre Dos Variables\n\nCuando se tiene dos variables respuesta numéricas continuas, se estudia la relación entre ellas utilizando el coeficiente de correlación de Pearson.\n\n### Visualización de la Relación\n\nVisualizamos la relación entre las variables `inc` y `yld` del conjunto de datos `mofo`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmofo <- read_excel(\"dados-diversos.xlsx\", \"mofo\")\n\nmofo |>\n  ggplot(aes(inc, yld))+\n  geom_point()+\n  geom_smooth(se = FALSE, method = \"lm\")+\n  facet_wrap(~ study)+\n  theme_few()\n```\n\n::: {.cell-output-display}\n![](Aula14_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Cálculo del Coeficiente de Correlación de Pearson\n\nUtilizamos la función `cor.test()` para calcular el coeficiente de correlación de Pearson y realizar un test de hipótesis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filtrar los datos del experimento 1\nmofo1 <- mofo |>\n  filter(study == 1)\n\n# Calcular el coeficiente de correlación de Pearson\ncor.test(mofo1$inc, mofo1$yld)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's product-moment correlation\n\ndata:  mofo1$inc and mofo1$yld\nt = -6.8451, df = 11, p-value = 2.782e-05\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n -0.9699609 -0.6921361\nsample estimates:\n       cor \n-0.8999278 \n```\n\n\n:::\n:::\n\n\n### Matriz de Correlación\n\nUna matriz de correlación muestra las correlaciones entre pares de variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcular la matriz de correlación para las variables seleccionadas\ncor(mofo1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      study      treat        inc        scl        yld\nstudy     1         NA         NA         NA         NA\ntreat    NA  1.0000000 -0.6830371 -0.6518545  0.7887185\ninc      NA -0.6830371  1.0000000  0.9128688 -0.8999278\nscl      NA -0.6518545  0.9128688  1.0000000 -0.9222418\nyld      NA  0.7887185 -0.8999278 -0.9222418  1.0000000\n```\n\n\n:::\n:::\n\n\n### Gráficos de Correlación\n\nUtilizamos el paquete `corrplot` para generar gráficos de correlación.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Instalar y cargar el paquete corrplot\nlibrary(corrplot)\n\n# Calcular la matriz de correlación\npcor <- cor(mofo1)\n\n# Crear el gráfico de correlación\ncorrplot(pcor, method = 'number', type = \"lower\")\n```\n\n::: {.cell-output-display}\n![](Aula14_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n## Modelo de Kendall\n\nEl coeficiente de correlación de Kendall es una medida no paramétrica de correlación. Es más robusto para datos no lineales o cuando la relación entre las variables no sigue una distribución normal.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Realizar el test de normalidad\nshapiro.test(mofo1$inc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  mofo1$inc\nW = 0.92076, p-value = 0.2568\n```\n\n\n:::\n\n```{.r .cell-code}\nshapiro.test(mofo1$yld)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  mofo1$yld\nW = 0.94388, p-value = 0.5091\n```\n\n\n:::\n\n```{.r .cell-code}\n# Calcular el coeficiente de correlación de Kendall\ncor.test(mofo1$inc, mofo1$yld, method = \"kendall\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tKendall's rank correlation tau\n\ndata:  mofo1$inc and mofo1$yld\nz = -3.6062, p-value = 0.0003107\nalternative hypothesis: true tau is not equal to 0\nsample estimates:\n       tau \n-0.7613062 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Calcular la matriz de correlación de Kendall\npcor_kendall <- cor(mofo1 |> select(3:5), method = \"kendall\")\n\n# Crear el gráfico de correlación de Kendall\ncorrplot(pcor_kendall, method = 'number', type = \"lower\")\n```\n\n::: {.cell-output-display}\n![](Aula14_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nEsta guía proporciona una introducción completa al análisis de correlación y ajuste de modelos lineales en RStudio. Cada paso incluye la explicación de los paquetes y funciones utilizados, lo que facilita su comprensión y aplicación para principiantes.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<script src=\"site_libs/jszip-1.13.6/jszip.min.js\"></script>\n<link href=\"site_libs/dt-ext-buttons-1.13.6/css/buttons.dataTables.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-ext-buttons-1.13.6/js/dataTables.buttons.min.js\"></script>\n<script src=\"site_libs/dt-ext-buttons-1.13.6/js/buttons.html5.min.js\"></script>\n<script src=\"site_libs/dt-ext-buttons-1.13.6/js/buttons.colVis.min.js\"></script>\n<script src=\"site_libs/dt-ext-buttons-1.13.6/js/buttons.print.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}